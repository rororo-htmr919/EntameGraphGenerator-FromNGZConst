<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>エンタメグラフジェネレーター</title>
<style>
  body {
    font-family: "Zen Maru Gothic", sans-serif;
    margin: 0;
    padding: 10px;
    background: #fdfcf9;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #formArea {
    width: 100%;
    max-width: 400px;
    margin-bottom: 20px;
  }
  input, button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    font-size: 1em;
    box-sizing: border-box;
  }
  #items div {
    margin-bottom: 5px;
    font-size: 0.9em;
  }
  #graphArea {
    background: #fff;
    border: 4px solid #333;
    padding: 15px;
    border-radius: 20px;
    text-align: center;
    max-width: 420px;
  }
  #titleText {
    font-size: 1.4em;
    margin-bottom: 10px;
    white-space: pre-line;
  }
  #graph {
    width: 100%;
    height: auto;
  }
  #list {
    margin-top: 15px;
    text-align: left;
  }
  .colorBox {
    display: inline-block;
    width: 14px;
    height: 14px;
    margin-right: 5px;
  }
  #buttonGroup button {
    margin-top: 10px;
  }
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500&display=swap">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<div id="formArea">
  <h3>入力フォーム</h3>
  <input type="text" id="name" placeholder="要素名" />
  <input type="number" id="rate" placeholder="割合(%)" />
  <button id="add">追加</button>
  <div id="items"></div>
  <button id="draw">作成</button>
</div>
<div id="graphArea">
  <div id="titleText">人生のエンタメグラフ\n#乃木坂工事中</div>
  <canvas id="graph" width="300" height="300"></canvas>
  <div id="list"></div>
</div>
<div id="buttonGroup">
  <button id="savePng">PNG保存</button>
  <button id="tweet">Xで共有</button>
</div>
<script>
const colors=["#e5332a","#f47b20","#faa220","#a3d65e","#09b29e","#4fb0e7","#6e51a3","#8a3f8f","#e91e63","#795548"];
let data=[];
document.getElementById('add').onclick=()=>{
  if(data.length>=10)return;
  const n=document.getElementById('name').value;
  const r=Number(document.getElementById('rate').value);
  if(!n||!r) return;
  data.push({name:n,rate:r});
  const div=document.createElement('div');
  div.textContent=`${n} : ${r}%`;
  document.getElementById('items').appendChild(div);
  document.getElementById('name').value="";
  document.getElementById('rate').value="";
};
document.getElementById('draw').onclick=()=>{
  const sorted=data.sort((a,b)=>b.rate-a.rate);
  const ctx=document.getElementById('graph').getContext('2d');
  ctx.clearRect(0,0,300,300);
  let start= -Math.PI/2;
  document.getElementById('list').innerHTML="";
  sorted.forEach((item,i)=>{
    const angle= item.rate/100 * 2*Math.PI;
    ctx.beginPath();
    ctx.moveTo(150,150);
    ctx.fillStyle=colors[i];
    ctx.arc(150,150,130,start,start+angle);
    ctx.fill();
    start += angle;
    const li=document.createElement('div');
    li.innerHTML=`<span class="colorBox" style="background:${colors[i]}"></span>${item.rate}% ${item.name}`;
    document.getElementById('list').appendChild(li);
  });
};
document.getElementById('savePng').onclick=()=>{
 html2canvas(document.getElementById('graphArea')).then(canvas=>{
   const a=document.createElement('a');
   a.download='graph.png';
   a.href=canvas.toDataURL();
   a.click();
 });
};
document.getElementById('tweet').onclick=()=>{
 html2canvas(document.getElementById('graphArea')).then(canvas=>{
   canvas.toBlob(blob=>{
     const url=URL.createObjectURL(blob);
     const text=encodeURIComponent('人生のエンタメグラフ\n#乃木坂工事中');
     const intent=`https://twitter.com/intent/post?text=${text}`;
     window.open(intent,'_blank');
   });
 });
};
</script>
</body>
</html>
